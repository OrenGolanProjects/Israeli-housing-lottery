import type { ApiProperty, Property } from './types';

// Note: This file contains sample data for development/testing
// In production, this should be replaced with actual API calls

const sampleApiData: ApiProperty[] = [
  {
    _id: 161,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 81,
    WinnersSeriesC: 0,
    WinnersSeriesB: 0,
    WinnersSeriesA: 81,
    WinnersBneyMakom: '41',
    Winners: 81,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 0,
    SubscribersSeriesB: 0,
    SubscribersSeriesA: 29450,
    SubscribersDisabled: 15,
    SubscribersBenyMakom: 8717,
    Subscribers: 29450,
    LotteryNativeHousingUnits: 28,
    LotteryHousingUnits: 81,
    LotterySignupNativeHousingUnits: '28',
    LotterySignupHousingUnits: 81,
    PriceForMeter: '15,500.00',
    ConstructionPermitName: 'החלטת ועדה (היתר בתנאים)',
    ProjectStatus: 'פתוח להרשמה',
    ProviderName: 'אלעד ישראל מגורים בע"מ',
    ProjectName: 'מגרשים 101',
    ProjectId: 135,
    Neighborhood: 'ק. שלום-מתחם ברנר',
    LamasName: 'תל אביב -יפו',
    LamasCode: 5000,
    LotteryExecutionDate: '2024-07-17 09:57:53',
    LotteryEndSignupDate: '2024-08-07 00:00:00',
    LotteryStatusValue: 'פורסמו תוצאות',
    Eligibility: 'א+ב+ג',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'הגרלה גדולה - מאי 2024',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 2399,
    rank: 0.09016734,
  },
  {
    _id: 691,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 163,
    WinnersSeriesC: 0,
    WinnersSeriesB: 0,
    WinnersSeriesA: 163,
    WinnersBneyMakom: '98',
    Winners: 163,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 0,
    SubscribersSeriesB: 0,
    SubscribersSeriesA: 23477,
    SubscribersDisabled: 13,
    SubscribersBenyMakom: 9981,
    Subscribers: 23477,
    LotteryNativeHousingUnits: 22,
    LotteryHousingUnits: 153,
    LotterySignupNativeHousingUnits: '22',
    LotterySignupHousingUnits: 153,
    PriceForMeter: '14,900.00',
    ConstructionPermitName: 'היתר מלא',
    ProjectStatus: 'בביצוע',
    ProviderName: 'אקרו יסודות בעיר 2018, שותפות מוגבל',
    ProjectName: 'מכבי יפו מתחם ג',
    ProjectId: 51600,
    Neighborhood: 'ק. שלום-מתחם ברנר',
    LamasName: 'תל אביב -יפו',
    LamasCode: 5000,
    LotteryExecutionDate: '2022-04-26 13:22:26',
    LotteryEndSignupDate: '2022-10-04 00:00:00',
    LotteryStatusValue: 'פורסמו תוצאות',
    Eligibility: 'א+ב+ג',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'הגרלה גדולה מרץ 2022',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 1845,
    rank: 0.09016734,
  },
  {
    _id: 1389,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 182,
    WinnersSeriesC: 13,
    WinnersSeriesB: 0,
    WinnersSeriesA: 169,
    WinnersBneyMakom: '145',
    Winners: 182,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 4526,
    SubscribersSeriesB: 2990,
    SubscribersSeriesA: 1142,
    SubscribersDisabled: 0,
    SubscribersBenyMakom: 3477,
    Subscribers: 8658,
    LotteryNativeHousingUnits: 85,
    LotteryHousingUnits: 199,
    LotterySignupNativeHousingUnits: '85',
    LotterySignupHousingUnits: 199,
    PriceForMeter: '15,500.00',
    ConstructionPermitName: 'טרם הוגשה בקשה',
    ProjectStatus: 'בתהליכי הגרלה',
    ProviderName: 'אלעד ישראל מגורים בע"מ',
    ProjectName: 'מגרשים 102,103,104,105,113,116,117',
    ProjectId: 134,
    Neighborhood: 'ק. שלום-מתחם ברנר',
    LamasName: 'תל אביב -יפו',
    LamasCode: 5000,
    LotteryExecutionDate: '2019-05-19 10:57:39',
    LotteryEndSignupDate: '2019-11-05 00:00:00',
    LotteryStatusValue: 'פורסמו תוצאות',
    Eligibility: 'לא מוגדר',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'מרץ 2019',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 1131,
    rank: 0.09016734,
  },
  {
    _id: 456,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 120,
    WinnersSeriesC: 0,
    WinnersSeriesB: 0,
    WinnersSeriesA: 120,
    WinnersBneyMakom: '60',
    Winners: 120,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 0,
    SubscribersSeriesB: 0,
    SubscribersSeriesA: 18000,
    SubscribersDisabled: 8,
    SubscribersBenyMakom: 7200,
    Subscribers: 18000,
    LotteryNativeHousingUnits: 40,
    LotteryHousingUnits: 120,
    LotterySignupNativeHousingUnits: '40',
    LotterySignupHousingUnits: 120,
    PriceForMeter: '16,200.00',
    ConstructionPermitName: 'היתר מלא',
    ProjectStatus: 'פתוח להרשמה',
    ProviderName: 'שיכון עובדים',
    ProjectName: 'גני העיר',
    ProjectId: 789,
    Neighborhood: 'גני העיר',
    LamasName: 'חיפה',
    LamasCode: 3000,
    LotteryExecutionDate: '2024-06-15 10:00:00',
    LotteryEndSignupDate: '2024-07-15 00:00:00',
    LotteryStatusValue: 'פתוח להרשמה',
    Eligibility: 'א+ב',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'הגרלה יוני 2024',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 2400,
    rank: 0.15000000,
  },
  {
    _id: 789,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 95,
    WinnersSeriesC: 0,
    WinnersSeriesB: 0,
    WinnersSeriesA: 95,
    WinnersBneyMakom: '48',
    Winners: 95,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 0,
    SubscribersSeriesB: 0,
    SubscribersSeriesA: 14250,
    SubscribersDisabled: 12,
    SubscribersBenyMakom: 5700,
    Subscribers: 14250,
    LotteryNativeHousingUnits: 30,
    LotteryHousingUnits: 95,
    LotterySignupNativeHousingUnits: '30',
    LotterySignupHousingUnits: 95,
    PriceForMeter: '13,800.00',
    ConstructionPermitName: 'החלטת ועדה (היתר בתנאים)',
    ProjectStatus: 'בביצוע',
    ProviderName: 'דיור ציבורי בע"מ',
    ProjectName: 'שכונת השלום',
    ProjectId: 456,
    Neighborhood: 'שכונת השלום',
    LamasName: 'באר שבע',
    LamasCode: 4000,
    LotteryExecutionDate: '2023-09-20 14:30:00',
    LotteryEndSignupDate: '2024-01-15 00:00:00',
    LotteryStatusValue: 'פורסמו תוצאות',
    Eligibility: 'א+ב+ג',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'הגרלה ספטמבר 2023',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 2000,
    rank: 0.15000000,
  }
];

// City coordinates mapping for sample data
const CITY_COORDINATES: { [city: string]: [number, number] } = {
  'תל אביב -יפו': [32.0853, 34.7818],
  'ירושלים': [31.7683, 35.2137],
  'חיפה': [32.7940, 34.9896],
  'באר שבע': [31.2500, 34.7900],
  'ראשון לציון': [31.9640, 34.8016],
  'פתח תקווה': [32.0849, 34.8720],
  'אשדוד': [31.8000, 34.6500],
  'נתניה': [32.3300, 34.8600],
  'חולון': [32.0200, 34.7800],
  'רמת גן': [32.0700, 34.8100],
  'הרצליה': [32.1700, 34.8400],
  'כפר סבא': [32.1700, 34.9000],
  'רחובות': [31.8900, 34.8100],
  'אשקלון': [31.6700, 34.5700],
  'קריית גת': [31.6100, 34.7600],
  'בית שמש': [31.7500, 35.0000],
  'קריית ביאליק': [32.8300, 35.0800],
  'קריית מוצקין': [32.8300, 35.0800],
  'קריית ים': [32.8300, 35.0800],
  'קריית אתא': [32.8300, 35.0800],
  'קריית שמונה': [33.2100, 35.5700],
  'טבריה': [32.7900, 35.5300],
  'צפת': [32.9700, 35.4900],
  'עכו': [32.9300, 35.0800],
  'נצרת': [32.7000, 35.3000],
  'אום אל-פחם': [32.5200, 35.1500],
  'נצרת עילית': [32.7000, 35.3000],
  'אריאל': [32.1000, 35.1000],
  'ביתר עילית': [31.7000, 35.1000],
  'מודיעין עילית': [31.7000, 35.1000],
  'אלעד': [32.0500, 34.9500],
  'אור יהודה': [32.0300, 34.8500],
  'יהוד-מונוסון': [32.0300, 34.8500],
  'גבעת שמואל': [32.0300, 34.8500],
  'גבעתיים': [32.0700, 34.8100],
  'קריית אונו': [32.0300, 34.8500],
  'קריית מלאכי': [31.7300, 34.7600]
};

// Helper function to get city coordinates
const getCityCoordinates = (city: string): [number, number] => {
  return CITY_COORDINATES[city] || [31.7683, 35.2137]; // Default to Jerusalem
};

// Helper function to parse price string to number
const parsePrice = (priceStr: string): number => {
  if (!priceStr) return 0;
  const cleanPrice = priceStr.replace(/[^\d.]/g, '');
  return parseFloat(cleanPrice) || 0;
};

// Helper function to calculate competition ratio
const calculateCompetitionRatio = (subscribers: number, winners: number): number => {
  if (winners === 0) return 0;
  return subscribers / winners;
};

// Export sample data for development/testing
export const sampleProperties: Property[] = sampleApiData.map(apiProp => {
  const city = apiProp.LamasName || 'Unknown City';
  const coordinates = getCityCoordinates(city);
  const pricePerMeter = parsePrice(apiProp.PriceForMeter);
  const competitionRatio = calculateCompetitionRatio(apiProp.Subscribers || 0, apiProp.Winners || 0);
  
  return {
    id: apiProp.ProjectId,
    name: apiProp.ProjectName || 'Unnamed Project',
    city: city,
    neighborhood: apiProp.Neighborhood || 'Unknown Neighborhood',
    pricePerMeter: pricePerMeter,
    totalUnits: apiProp.LotteryHousingUnits || 0,
    totalSubscribers: apiProp.Subscribers || 0,
    totalWinners: apiProp.Winners || 0,
    competitionRatio: competitionRatio,
    status: apiProp.ProjectStatus || 'Unknown',
    provider: apiProp.ProviderName || 'Unknown Provider',
    lotteryDate: apiProp.LotteryExecutionDate || '',
    signupDeadline: apiProp.LotteryEndSignupDate || '',
    constructionPermit: apiProp.ConstructionPermitName || 'Unknown',
    eligibility: apiProp.Eligibility || 'Unknown',
    marketingMethod: apiProp.MarketingMethodDesc || 'Unknown',
    coordinates: coordinates,
    isCityLevelCoordinates: true
  };
});

export const cities = Array.from(new Set(sampleProperties.map(p => p.city)));
export const statuses = Array.from(new Set(sampleProperties.map(p => p.status)));
export const constructionPermits = Array.from(new Set(sampleProperties.map(p => p.constructionPermit)));
export const eligibilityTypes = Array.from(new Set(sampleProperties.map(p => p.eligibility)));

export const API_CONFIG = {
  baseUrl: 'https://data.gov.il/api/3/action/datastore_search',
  resourceId: '7c8255d0-49ef-49db-8904-4cf917586031',
  defaultLimit: 100,
};
  