import type { ApiProperty, Property } from './types';

export const convertApiProperty = (apiProp: ApiProperty): Property => {
  const pricePerMeter = parseFloat(apiProp.PriceForMeter.replace(/,/g, ''));
  const competitionRatio =
    apiProp.Subscribers > 0
      ? parseFloat((apiProp.Subscribers / apiProp.Winners).toFixed(1))
      : 0;

  const cityCoordinates: Record<string, [number, number]> = {
    'תל אביב -יפו': [32.0853, 34.7818],
    'חיפה': [32.7940, 34.9896],
    'באר שבע': [31.2518, 34.7913],
    'ירושלים': [31.7683, 35.2137],
    'אשדוד': [31.8044, 34.6503],
    'פתח תקווה': [32.0840, 34.8878],
    'נתניה': [32.3328, 34.8600],
    'ראשון לציון': [31.9522, 34.8033],
    'רחובות': [31.8928, 34.8113],
    'אשקלון': [31.6688, 34.5717],
    'קריית גת': [31.6100, 34.7642],
    'קריית שמונה': [33.2079, 35.5702],
    'אופקים': [31.2739, 34.6200],
    'ערד': [31.2628, 35.2147],
    'דימונה': [31.0690, 35.0333],
    'ירוחם': [30.9881, 34.9311],
    'מצפה רמון': [30.6100, 34.8000],
    'אילת': [29.5577, 34.9519],
    'אריאל': [32.1044, 35.1797],
    'בית שאן': [32.4971, 35.4962],
    'טבריה': [32.7947, 35.5327],
    'צפת': [32.9646, 35.4960],
    'עכו': [32.9281, 35.0820],
    'נהריה': [33.0089, 35.0981],
    'קריית מוצקין': [32.8373, 35.0776],
    'קריית ביאליק': [32.8273, 35.0857],
    'קריית ים': [32.8493, 35.0683],
    'קריית אתא': [32.8114, 35.1133],
    'קריית טבעון': [32.7234, 35.1276],
    'מודיעין עילית': [31.9322, 35.0442],
    'ביתר עילית': [31.6889, 35.1144],
    'אלעד': [32.0500, 34.9500],
    'עמנואל': [31.9333, 35.2167],
    'בית אל': [31.9333, 35.2167],
    'קדומים': [32.2167, 35.1667],
    'עלי': [32.0667, 35.2667],
    'שילה': [32.0500, 35.3000],
    'אלקנה': [32.1167, 35.0333],
    'קרני שומרון': [32.1667, 35.1000],
    'אורנית': [32.1333, 34.9333],
    'קריית ארבע': [31.5333, 35.1000]
  };

  return {
    id: apiProp._id,
    name: apiProp.ProjectName,
    city: apiProp.LamasName,
    neighborhood: apiProp.Neighborhood,
    pricePerMeter,
    totalUnits: apiProp.LotteryHousingUnits,
    totalSubscribers: apiProp.Subscribers,
    totalWinners: apiProp.Winners,
    competitionRatio,
    status: apiProp.ProjectStatus,
    provider: apiProp.ProviderName,
    lotteryDate: apiProp.LotteryExecutionDate.split(' ')[0],
    signupDeadline: apiProp.LotteryEndSignupDate.split(' ')[0],
    constructionPermit: apiProp.ConstructionPermitName,
    eligibility: apiProp.Eligibility,
    marketingMethod: apiProp.MarketingMethodDesc,
    coordinates: cityCoordinates[apiProp.LamasName] || [31.7683, 35.2137],
  };
};

const sampleApiData: ApiProperty[] = [
  {
    _id: 161,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 81,
    WinnersSeriesC: 0,
    WinnersSeriesB: 0,
    WinnersSeriesA: 81,
    WinnersBneyMakom: '41',
    Winners: 81,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 0,
    SubscribersSeriesB: 0,
    SubscribersSeriesA: 29450,
    SubscribersDisabled: 15,
    SubscribersBenyMakom: 8717,
    Subscribers: 29450,
    LotteryNativeHousingUnits: 28,
    LotteryHousingUnits: 81,
    LotterySignupNativeHousingUnits: '28',
    LotterySignupHousingUnits: 81,
    PriceForMeter: '15,500.00',
    ConstructionPermitName: 'החלטת ועדה (היתר בתנאים)',
    ProjectStatus: 'פתוח להרשמה',
    ProviderName: 'אלעד ישראל מגורים בע"מ',
    ProjectName: 'מגרשים 101',
    ProjectId: 135,
    Neighborhood: 'ק. שלום-מתחם ברנר',
    LamasName: 'תל אביב -יפו',
    LamasCode: 5000,
    LotteryExecutionDate: '2024-07-17 09:57:53',
    LotteryEndSignupDate: '2024-08-07 00:00:00',
    LotteryStatusValue: 'פורסמו תוצאות',
    Eligibility: 'א+ב+ג',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'הגרלה גדולה - מאי 2024',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 2399,
    rank: 0.09016734,
  },
  {
    _id: 691,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 163,
    WinnersSeriesC: 0,
    WinnersSeriesB: 0,
    WinnersSeriesA: 163,
    WinnersBneyMakom: '98',
    Winners: 163,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 0,
    SubscribersSeriesB: 0,
    SubscribersSeriesA: 23477,
    SubscribersDisabled: 13,
    SubscribersBenyMakom: 9981,
    Subscribers: 23477,
    LotteryNativeHousingUnits: 22,
    LotteryHousingUnits: 153,
    LotterySignupNativeHousingUnits: '22',
    LotterySignupHousingUnits: 153,
    PriceForMeter: '14,900.00',
    ConstructionPermitName: 'היתר מלא',
    ProjectStatus: 'בביצוע',
    ProviderName: 'אקרו יסודות בעיר 2018, שותפות מוגבל',
    ProjectName: 'מכבי יפו מתחם ג',
    ProjectId: 51600,
    Neighborhood: 'ק. שלום-מתחם ברנר',
    LamasName: 'תל אביב -יפו',
    LamasCode: 5000,
    LotteryExecutionDate: '2022-04-26 13:22:26',
    LotteryEndSignupDate: '2022-10-04 00:00:00',
    LotteryStatusValue: 'פורסמו תוצאות',
    Eligibility: 'א+ב+ג',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'הגרלה גדולה מרץ 2022',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 1845,
    rank: 0.09016734,
  },
  {
    _id: 1389,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 182,
    WinnersSeriesC: 13,
    WinnersSeriesB: 0,
    WinnersSeriesA: 169,
    WinnersBneyMakom: '145',
    Winners: 182,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 4526,
    SubscribersSeriesB: 2990,
    SubscribersSeriesA: 1142,
    SubscribersDisabled: 0,
    SubscribersBenyMakom: 3477,
    Subscribers: 8658,
    LotteryNativeHousingUnits: 85,
    LotteryHousingUnits: 199,
    LotterySignupNativeHousingUnits: '85',
    LotterySignupHousingUnits: 199,
    PriceForMeter: '15,500.00',
    ConstructionPermitName: 'טרם הוגשה בקשה',
    ProjectStatus: 'בתהליכי הגרלה',
    ProviderName: 'אלעד ישראל מגורים בע"מ',
    ProjectName: 'מגרשים 102,103,104,105,113,116,117',
    ProjectId: 134,
    Neighborhood: 'ק. שלום-מתחם ברנר',
    LamasName: 'תל אביב -יפו',
    LamasCode: 5000,
    LotteryExecutionDate: '2019-05-19 10:57:39',
    LotteryEndSignupDate: '2019-11-05 00:00:00',
    LotteryStatusValue: 'פורסמו תוצאות',
    Eligibility: 'לא מוגדר',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'מרץ 2019',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 1131,
    rank: 0.09016734,
  },
  {
    _id: 456,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 120,
    WinnersSeriesC: 0,
    WinnersSeriesB: 0,
    WinnersSeriesA: 120,
    WinnersBneyMakom: '60',
    Winners: 120,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 0,
    SubscribersSeriesB: 0,
    SubscribersSeriesA: 18000,
    SubscribersDisabled: 8,
    SubscribersBenyMakom: 7200,
    Subscribers: 18000,
    LotteryNativeHousingUnits: 40,
    LotteryHousingUnits: 120,
    LotterySignupNativeHousingUnits: '40',
    LotterySignupHousingUnits: 120,
    PriceForMeter: '16,200.00',
    ConstructionPermitName: 'היתר מלא',
    ProjectStatus: 'פתוח להרשמה',
    ProviderName: 'שיכון עובדים',
    ProjectName: 'גני העיר',
    ProjectId: 789,
    Neighborhood: 'גני העיר',
    LamasName: 'חיפה',
    LamasCode: 3000,
    LotteryExecutionDate: '2024-06-15 10:00:00',
    LotteryEndSignupDate: '2024-07-15 00:00:00',
    LotteryStatusValue: 'פתוח להרשמה',
    Eligibility: 'א+ב',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'הגרלה יוני 2024',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 2400,
    rank: 0.15000000,
  },
  {
    _id: 789,
    WinnersMeshapryDiur: 0,
    WinnersHasryDiur: 95,
    WinnersSeriesC: 0,
    WinnersSeriesB: 0,
    WinnersSeriesA: 95,
    WinnersBneyMakom: '48',
    Winners: 95,
    SubscribersMeshapryDiur: 0,
    SubscribersSeriesC: 0,
    SubscribersSeriesB: 0,
    SubscribersSeriesA: 14250,
    SubscribersDisabled: 12,
    SubscribersBenyMakom: 5700,
    Subscribers: 14250,
    LotteryNativeHousingUnits: 30,
    LotteryHousingUnits: 95,
    LotterySignupNativeHousingUnits: '30',
    LotterySignupHousingUnits: 95,
    PriceForMeter: '13,800.00',
    ConstructionPermitName: 'החלטת ועדה (היתר בתנאים)',
    ProjectStatus: 'בביצוע',
    ProviderName: 'דיור ציבורי בע"מ',
    ProjectName: 'שכונת השלום',
    ProjectId: 456,
    Neighborhood: 'שכונת השלום',
    LamasName: 'באר שבע',
    LamasCode: 4000,
    LotteryExecutionDate: '2023-09-20 14:30:00',
    LotteryEndSignupDate: '2024-01-15 00:00:00',
    LotteryStatusValue: 'פורסמו תוצאות',
    Eligibility: 'א+ב+ג',
    MarketingRep: 'רמ"י',
    MarketingMethodDesc: 'מחיר למשתכן',
    MarketingMethod: 19,
    CentralizationType: 'הגרלה ספטמבר 2023',
    ContinLotteryId: '-',
    ParentLotteryId: '-',
    LotteryType: 'ראשונה',
    LotteryId: 2000,
    rank: 0.15000000,
  }
];

export const sampleProperties: Property[] = sampleApiData.map(convertApiProperty);

export const cities = Array.from(new Set(sampleProperties.map(p => p.city)));
export const statuses = Array.from(new Set(sampleProperties.map(p => p.status)));
export const constructionPermits = Array.from(new Set(sampleProperties.map(p => p.constructionPermit)));
export const eligibilityTypes = Array.from(new Set(sampleProperties.map(p => p.eligibility)));

export const API_CONFIG = {
  baseUrl: 'https://data.gov.il/api/3/action/datastore_search',
  resourceId: '7c8255d0-49ef-49db-8904-4cf917586031',
  defaultLimit: 100,
};
  